#!/bin/bash

# Mac Agent 전역 명령어 스크립트
# 사용법: mac_agent "명령어"

# 스크립트의 실제 위치 찾기 (심볼릭 링크 해결)
if [ -L "${BASH_SOURCE[0]}" ]; then
    # 심볼릭 링크인 경우 실제 파일 경로 찾기
    SCRIPT_PATH=$(readlink "${BASH_SOURCE[0]}")
    SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
else
    # 일반 파일인 경우
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
fi

APP_DIR="$SCRIPT_DIR/app"

# app 디렉토리가 존재하는지 확인
if [ ! -d "$APP_DIR" ]; then
    echo "❌ 오류: app 디렉토리를 찾을 수 없습니다."
    echo "현재 위치: $SCRIPT_DIR"
    echo "찾는 위치: $APP_DIR"
    exit 1
fi

# main.py 파일이 존재하는지 확인
if [ ! -f "$APP_DIR/main.py" ]; then
    echo "❌ 오류: main.py 파일을 찾을 수 없습니다."
    echo "예상 위치: $APP_DIR/main.py"
    exit 1
fi

# 인수가 제공되었는지 확인
if [ $# -eq 0 ]; then
    echo "🤖 Mac Agent - 지능형 캘린더 에이전트"
    echo ""
    echo "사용법:"
    echo "  mac_agent \"명령어\"                    # 단일 명령어 실행"
    echo "  mac_agent -t                          # 테스트 모드"
    echo "  mac_agent -i                          # 대화형 모드"
    echo ""
    echo "예시:"
    echo "  mac_agent \"6월 30일 오후 4시 - 팀 미팅\""
    echo "  mac_agent \"팀 미팅 일정 찾아줘\""
    echo "  mac_agent \"내일 약속 삭제해줘\""
    exit 0
fi

# app 디렉토리로 이동하여 실행
cd "$SCRIPT_DIR/app" && python main.py -c "$1"